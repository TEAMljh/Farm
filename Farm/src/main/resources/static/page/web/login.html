<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>网站前台登录页面</title>
  <link rel="stylesheet" type="text/css" href="/assets/css/main.css">
  <link rel="stylesheet" type="text/css" href="/assets/libs/layui/css/layui.css">
  <script type="text/javascript" src="/assets/libs/layui/layui.js"></script>
  <script type="text/javascript" src="/assets/js/common.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
</head>
<body>
<div id="moveMouse" style="background-image: url('../../assets/img/Watermelon.png');background-repeat:no-repeat;background-size:100% 100%;-moz-background-size:100% 100%;
 width: 40px;height: 40px;position:absolute;z-index: 1000;left:-40px;top: -40px;"></div>
  <div class="site-nav-bg">
    <div class="site-nav w1200">
      <p class="sn-back-home">
        <i class="layui-icon layui-icon-home"></i>
        <a href="commodity.html">首页</a>
      </p>
      <div class="sn-quick-menu">
        <div class="login"><a href="login.html">登录</a></div>
        <div class="sp-cart"><a href="shopcart.html">购物车</a><i class="layui-icon layui-icon-cart-simple"></i></div>
      </div>
    </div>
  </div>



  <div class="header">
    <div class="headerLayout w1200">
      <div class="headerCon">
        <h1 class="mallLogo">
          <a href="#" title="农产品">
            <img src="/assets/img/农产品小标题.png">
            <img src="/assets/img/标题2.jpg" >
            <img src="/assets/img/小标题3.jpg">
          </a>
        </h1>
        <div class="mallSearch">
          <form action="" class="layui-form" novalidate>
            <input id="search_pro" type="text" name="title" required  lay-verify="required" autocomplete="off" class="layui-input" placeholder="请输入需要的商品">
            <input type="button" class="search_bt" class="layui-btn" lay-verify="required" value="🔍">
            <input type="hidden" name="" value="">
          </form>
        </div>
      </div>
    </div>
  </div>


  <div class="content content-nav-base  login-content">
    <div class="main-nav">
      <div class="inner-cont0">
        <div class="inner-cont1 w1200">
          <div class="inner-cont2">
            <a href="commodity.html" class="active">所有商品</a>
            <a href="buytoday.html">今日团购</a>
            <a href="information.html">农产品资讯</a>
            <a href="about.html">关于我们</a>
          </div>
        </div>
      </div>
    </div>
    <div class="login-bg" style="background-image: url('../../assets/img/back2.jpg');background-repeat:no-repeat;background-size:100% 100%;-moz-background-size:100% 100%;background-position: 0 10%">
      <div class="login-cont w1200">
        <div class="form-box">
          <form class="layui-form" action="">
            <legend>用户登录</legend>
            <div class="layui-form-item">
              <div class="layui-inline iphone">
                <div class="layui-input-inline">
                  <i class="layui-icon layui-icon-cellphone iphone-icon"></i>
                  <input type="text" name="name" id="username" lay-verify="name" placeholder="请输入用户名" autocomplete="off" class="layui-input pnum">
                </div>
              </div>
              <div class="layui-inline veri-code">
                <div class="layui-input-inline">
                  <i class="layui-icon layui-icon-password password-icon"></i>
                  <input id="password" type="password" name="pass" lay-verify="required|pass" placeholder="请输入密码" autocomplete="off" class="layui-input pnum pass">
                  <!--<input type="button" class="layui-btn" id="find"  value="验证码" /> -->
                </div>
              </div>
            </div>
            <div class="layui-form-item login-btn">
              <div class="layui-input-block">
                <button class="layui-btn" id="login" lay-submit="" lay-filter="demo1" onclick="return false">登录</button>
              </div>
            </div>
          </form>
          <div class="layui-input-line">
            <button class="layui-btn" id="new_user" lay-submit="" lay-filter="demo2" onclick="return false">注册</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">
    <div class="ng-promise-box">
      <div class="ng-promise w1200">
        <p class="text">
          <a class="icon1" href="javascript:;">7天无理由退换货</a>
          <a class="icon2" href="javascript:;">满99元全场免邮</a>
          <a class="icon3" style="margin-right: 0" href="javascript:;">100%品质保证</a>
        </p>
      </div>
    </div>
    <div class="mod_help w1200">                                     
      <p>
        <a href="about.html">关于我们</a>
        <span>|</span>
        <a href="javascript:;">帮助中心</a>
        <span>|</span>
        <a href="about.html">售后服务</a>
        <span>|</span>
        <a href="information.html">特色农产品资讯</a>
        <span>|</span>
        <a href="javascript:;">关于货源</a>
      </p>
      <p class="coty">农产品商城版权所有 &copy; 2012-2020</p>
    </div>
  </div>
<!--  表单弹出-->
  <script type="text/html" id="register">
    <div class="form-box1">
    <form class="layui-form" action="" id="registerForm" lay-filter="registerForm">
            <legend>用户注册</legend>
            <div class="layui-form-item">
            <div class="layui-inline veri-code">
            <div class="layui-input-inline" style="width:270px;">
            <i class="layui-icon layui-icon-username iphone-icon"></i>
            <input type="text" name="name" id="name" lay-verify="name" placeholder="用户名,可包括汉字或字母(3~11)" autocomplete="off" class="layui-input">
            </div>
            </div>
              <div class="layui-inline veri-code">
                <div class="layui-input-inline" style="width:270px;">
                  <i class="layui-icon layui-icon-cellphone iphone-icon"></i>
                  <input type="text" name="tel" id="phone" lay-verify="phone" placeholder="输入手机号" autocomplete="off" class="layui-input">
                </div>
              </div>
            <div class="layui-inline veri-code">
            <div class="layui-input-inline" style="width:270px;">
            <i class="layui-icon layui-icon-password password-icon"></i>
            <input type="password" id="pass" type="password" name="pass" lay-verify="pass" placeholder="密码,可包括字母数字和下划线(3~11)" autocomplete="off" class="layui-input pnum pass">
            </div>
            </div>
              <div class="layui-inline veri-code">
                <div class="layui-input-inline" style="width:270px;">
                  <i class="layui-icon layui-icon-location location-icon"></i>
                  <input type="text" id="province" name="province" lay-verify="province" placeholder="请输入所在省(3~8)" autocomplete="off" class="layui-input pnum">
                </div>
              </div>
              <div class="layui-inline veri-code">
                <div class="layui-input-inline" style="width:270px;">
                  <i class="layui-icon layui-icon-location location-icon"></i>
                  <input type="text" id="city" name="city" lay-verify="city" placeholder="请输入所在市(3~8)" autocomplete="off" class="layui-input pnum">
                </div>
              </div>
              <div class="layui-inline veri-code">
                <div class="layui-input-inline" style="width:270px;">
                  <i class="layui-icon layui-icon-location location-icon"></i>
                  <input type="text" id="county" name="county" lay-verify="county" placeholder="请输入所在县(3~8)" autocomplete="off" class="layui-input pnum">
                </div>
              </div>
              <div class="layui-inline veri-code">
                <div class="layui-input-inline" style="width:270px;">
                  <i class="layui-icon layui-icon-location location-icon"></i>
                  <input type="text" id="detail" name="detail" lay-verify="detail" placeholder="请输入详细地址(9~30)" autocomplete="off" class="layui-input pnum">
                </div>
              </div>
            </div>
      <div class="layui-form-item text-right">
        <button style="right: 100px;width: 100px;" class="layui-btn layui-btn-primary layui-layer-close layui-layer-close1"
                type="button" ew-event="closeDialog">取消
        </button>
        <button class="layui-btn" lay-filter="register" id="register2" lay-submit=""  style="margin-left: 100px;width: 100px;">保存</button>
      </div>
            </form>
    </div>
  </script>
  <script type="text/javascript">
   layui.use(['jquery','form','layer','admin'],function(){
          var $ = layui.$,form = layui.form,layer = layui.layer,admin=layui.admin;


     $('html').hide();
     $('html').fadeIn(1000);

     //模糊查询
     $(document).on('click','.search_bt',function () {
       sessionStorage.setItem('keyWord',$('#search_pro').val());
       window.location.href = '/page/web/commodity.html';
     });

     //表单验证
     form.verify({
       name:[/^[\u4e00-\u9fa5]|[a-zA-Z]{2,11}$/,'请输入正确的4-11位用户名'],
       pass:[/^(\w){3,11}$/,'请输入正确的3-11位密码,可包括字母、数字和下划线'],
       province:[/^[\u4e00-\u9fa5]*[省]{3,8}$/,'请输入正确地名'],
       city:[/^[\u4e00-\u9fa5]{3,8}$/,'请输入正确地名'],
       county:[/^[\u4e00-\u9fa5]{3,8}$/,'请输入正确地名'],
       detail:[/^[\u4e00-\u9fa5]{9,30}$/,'请输入正确地名']
     });

         // 表单提交、登录
         form.on('submit(demo1)', function (data) {
           var field = data.field;
           console.log(field);

           //表单提交
           $.ajax({
             type:"get",
             data: field,
             url: "/main/login",
             // dataType:"json",
             success:function (res) {
               admin.btnLoading('#btnLoading', false);
               if (res.code==0){
                 layer.msg('登录成功', {icon: 1, time: 1000}, function () {
                   sessionStorage.setItem('login_success',res.code);
                   sessionStorage.setItem('username',$('#username').val());
                   sessionStorage.setItem('address1',res.data.province);
                   sessionStorage.setItem('address2',res.data.city);
                   sessionStorage.setItem('address3',res.data.county);
                   sessionStorage.setItem('userAddress',res.data.detail);
                   sessionStorage.setItem('changeUserId',res.data.id);
                   console.log(sessionStorage.getItem('userAddress'));
                   sessionStorage.setItem('tel',res.data.tel);
                   location.replace('/page/web/commodity.html');
                 });
               }else {
                 admin.btnLoading('#btnLoading', false);
                 layer.msg('登录失败，请重试<br><cite>(' + res.msg + ')</cite>', {icon: 5});
               }
             }
           });
           return false;
         });

     //注册弹出
     form.on('submit(demo2)',function(data) {
       layer.open({
         type: 1,
         title: '注册',
         area: '800px',
         shade: 0.3,
         content: $('#register').html(),
         success: function (layero, index) {  //弹出成功的回调
           console.log('弹出了' + layero, index);

           //表单验证
           form.verify({
             name:[/^[a-zA-Z\u4E00-\u9FA5][a-zA-Z0-9\u4E00-\u9FA5_-]{2,11}$/,'请输入正确的3-11位用户名'],
             pass:[/^(\w){3,11}$/,'请输入正确的3-11位密码,可包括字母、数字和下划线'],
             province:[/^[\u4e00-\u9fa5]{3,8}$/,'请输入正确地名'],
             city:[/^[\u4e00-\u9fa5]{3,8}$/,'请输入正确地名'],
             county:[/^[\u4e00-\u9fa5]{3,8}$/,'请输入正确地名'],
             detail:[/^[\u4e00-\u9fa5]{9,30}$/,'请输入正确地名']
           });

           //验证

           form.on('submit(register)',function (data) {
             var field01 = data.field;

             $.ajax({
               type: "get",
               url: "/main/login/register",
               data: field01,
               success: function (res) {
                 admin.btnLoading('#btnLoading', false);
                 if (res.code == 0) {
                   layer.msg(res.msg, {icon: 1, time: 1500}, function () {
                     location.replace('/page/web/login.html');
                   });
                 }else{
                   layer.msg(res.msg);
                   form.render();
                 }

               }, error: function () {
               }
             });
             return false;
           });
         }
       })

     });


     //鼠标
     $(function () {
       var moveMouse = $('#moveMouse');
       $(document).mousemove(function (event) {
         event = event || window.event;
         var x = $(window).scrollTop();
         var left = event.clientX;
         var top = event.clientY;
         moveMouse.css('left', (left + 15)+ 'px');
         moveMouse.css('top', (top + x) + 'px');
       })
     });
    })
  </script>
</body>
</html>