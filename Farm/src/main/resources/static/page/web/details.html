<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>单品详情</title>
  <link rel="stylesheet" type="text/css" href="/assets/css/main.css">
  <link rel="stylesheet" type="text/css" href="/assets/libs/layui/css/layui.css">
  <script type="text/javascript" src="/assets/libs/layui/layui.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
</head>
<body>

  <div class="site-nav-bg">
    <div class="site-nav w1200">
      <p class="sn-back-home">
        <i class="layui-icon layui-icon-home"></i>
        <a href="commodity.html">首页</a>
      </p>
      <div class="sn-quick-menu">
       <div class="login"><a href="login.html">登录</a></div>
        <div class="sp-cart"><a href="shopcart.html">购物车</a><i class="layui-icon layui-icon-cart-simple"></i></div>
      </div>
    </div>
  </div>



  <div class="header">
    <div class="headerLayout w1200">
      <div class="headerCon">
        <h1 class="mallLogo">
          <a href="#" title="农产品">
            <img src="/assets/img/农产品小标题.png">
          </a>
        </h1>
        <div class="mallSearch">
          <form action="" class="layui-form" novalidate>
            <input id="search_pro" type="text" name="title" required  lay-verify="required" autocomplete="off" class="layui-input" placeholder="请输入需要的商品">
            <input type="button" class="search_bt" class="layui-btn" lay-verify="required" value="🔍">
            <input type="hidden" name="" value="">
          </form>
        </div>
      </div>
    </div>
  </div>


  <div class="content content-nav-base datails-content">
    <div class="main-nav">
      <div class="inner-cont0">
        <div class="inner-cont1 w1200">
          <div class="inner-cont2">
            <a href="commodity.html">所有商品</a>
            <a href="buytoday.html">今日团购</a>
            <a href="information.html">农产品资讯</a>
            <a href="about.html">关于我们</a>
          </div>
        </div>
      </div>
    </div>
    <div class="data-cont-wrap w1200">
      <div class="crumb">
        <a href="commodity.html">首页</a>
        <span>></span>
        <a href="commodity.html">所有商品</a>
        <span>></span>
        <a href="javascript:;">产品详情</a>
      </div>
      <div class="product-intro layui-clear">
        <div class="preview-wrap">
          <a href="javascript:;"><img src="" class="detail_img" style="width: 400px;height: 400px;"></a>
        </div>
        <div class="itemInfo-wrap">
          <div class="itemInfo">
            <div class="title">
              <h4 class="detail_name"></h4>
              <span>
                <!--<i class="layui-icon layui-icon-rate-solid"></i>-->
                <!--收藏-->
              </span>
            </div>
            <div class="summary">
              <p class="reference"><span>参考价</span> <del class="detail_old"></del></p>
              <p class="activity"><span>活动价</span><strong class="price"><i>￥</i><span class="detail_pri"></span></strong></p>
              <p class="address-box"><span>送&nbsp;&nbsp;&nbsp;至</span>
                <strong class="address detail_address"></strong></p>
            </div>
            <div class="choose-attrs">
              <div class="color layui-clear"><span class="title">单品规格</span> <div class="color-cont"><span class="detail_single"></span> </div></div>
              <div class="number layui-clear"><span class="title">数&nbsp;&nbsp;&nbsp;量</span><div class="number-cont"><span class="cut btn">-</span><input onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" maxlength="4" type="" name="" placeholder="1" value="1" class="num"><span class="add btn">+</span></div></div>
            </div>
            <div class="choose-btns">
              <button class="layui-btn layui-btn-primary purchase-btn buyNow-btn">立刻购买</button>
              <button class="layui-btn  layui-btn-danger car-btn"><i class="layui-icon layui-icon-cart-simple"></i>加入购物车</button>  
            </div>
          </div>
        </div>
      </div>
      <div class="layui-clear">
        <div class="detail">
          <h4>详情</h4>
          <div class="item">
            <img src="/assets/img/details_imgbig.jpg" class="detail_bigImg">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--  修改信息弹窗-->
  <script type="text/html" id="changeUser">
    <div class="form-box1">
      <form class="layui-form" action="" id="changeUserForm" lay-filter="changeUserForm">
        <legend>用户修改信息</legend>
        <div class="layui-form-item">
          <input type="text" id="changeUserId" name="id" value="" style="display: none">
          <div class="layui-inline veri-code">
            <div class="layui-input-inline" style="width:270px;">
              <i class="layui-icon layui-icon-username iphone-icon"></i>
              <input type="text" name="name" id="name" lay-verify="name" placeholder="" autocomplete="off" class="layui-input layui-disabled" style="color: #0C0C0C;">*用户名不可更改
            </div>
          </div>
          <div class="layui-inline veri-code">
            <div class="layui-input-inline" style="width:270px;">
              <i class="layui-icon layui-icon-cellphone iphone-icon"></i>
              <input type="text" name="tel" id="phone" lay-verify="phone" placeholder="修改手机号" autocomplete="off" class="layui-input">
            </div>
          </div>
          <div class="layui-inline veri-code">
            <div class="layui-input-inline" style="width:270px;">
              <i class="layui-icon layui-icon-password password-icon"></i>
              <input type="password" id="pass" type="password" name="pass" lay-verify="pass" placeholder="修改密码" autocomplete="off" class="layui-input pnum pass">
            </div>
          </div>
          <div class="layui-inline veri-code">
            <div class="layui-input-inline" style="width:270px;">
              <i class="layui-icon layui-icon-location location-icon"></i>
              <input type="text" id="province" name="province" lay-verify="province" placeholder="修改所在省" autocomplete="off" class="layui-input pnum">
            </div>
          </div>
          <div class="layui-inline veri-code">
            <div class="layui-input-inline" style="width:270px;">
              <i class="layui-icon layui-icon-location location-icon"></i>
              <input type="text" id="city" name="city" lay-verify="city" placeholder="修改所在市" autocomplete="off" class="layui-input pnum">
            </div>
          </div>
          <div class="layui-inline veri-code">
            <div class="layui-input-inline" style="width:270px;">
              <i class="layui-icon layui-icon-location location-icon"></i>
              <input type="text" id="county" name="county" lay-verify="county" placeholder="修改所在县" autocomplete="off" class="layui-input pnum">
            </div>
          </div>
          <div class="layui-inline veri-code">
            <div class="layui-input-inline" style="width:270px;">
              <i class="layui-icon layui-icon-location location-icon"></i>
              <input type="text" id="detail" name="detail" lay-verify="detail" placeholder="修改详细地址" autocomplete="off" class="layui-input pnum">
            </div>
          </div>
        </div>
        <div class="layui-form-item text-right">
          <button style="right: 100px;width: 100px;" class="layui-btn layui-btn-primary layui-layer-close layui-layer-close1"
                  type="button" ew-event="closeDialog">取消
          </button>
          <button class="layui-btn" lay-filter="changeUser" id="changeUser2" lay-submit=""  style="margin-left: 100px;width: 100px;">保存</button>
        </div>
      </form>
    </div>
  </script>
<script type="text/javascript">
  layui.config({
    base: '/assets/js/util/' //你存放新模块的目录，注意，不是layui的模块目录
  }).use(['mm','jquery','layer','login_on'],function(){
      var mm = layui.mm,$ = layui.$,layer = layui.layer,login_on = layui.login_on;

    $('html').hide();
    $('html').fadeIn(500);

    //显示用户
    login_on.login_success();
    //用户退出
    $('.quit').on('click',function () {
      login_on.login_quit();
      layer.msg('已成功退出',{icon:1,time:1500},function () {
        location.replace('/page/web/login.html');
      });
    });
    //用户修改密码
    $(document).on('click','#change',function () {
      login_on.login_changeUser();
    });


    //模糊查询
    $(document).on('click','.search_bt',function () {
      sessionStorage.setItem('keyWord',$('#search_pro').val());
      window.location.href = '/page/web/commodity.html';
    });


    //获取具体商品信息
        var pro_detail = sessionStorage.getItem('pro_detail');
        // console.log("这是具体商品：" + pro_detail);
        show(pro_detail);

    function show(pro_detail){
      $.ajax({
        type:"get",
        url: "/main/productdisplay?id=" + pro_detail,
        dataType:"json",
        success:function (res) {
          $('.detail_name').html(res.name);
          $('.detail_old').html('￥' + res.oldPri + '&nbsp;');
          $('.detail_pri').html(res.pri);
          $('.detail_single').html(res.single);
          $('.detail_img').attr('src',res.img);
          $('.detail_bigImg').attr('src',res.imgDetail);
          if (sessionStorage.getItem('address1') == null) {
            $('.detail_address').html('亲!请先登录!')
          }else{
            $('.detail_address').html(sessionStorage.getItem('address1')+  '&nbsp;'+sessionStorage.getItem('address2') +  '&nbsp;'+sessionStorage.getItem('address3'));

          }

          //加购物车
          $(document).on('click','.car-btn',function () {
            if (sessionStorage.getItem('login_success') == 0) {
              $.ajax({
                type:"get",
                url: "/main/shopcart",
                // dataType:"json",
                data:{
                  img : res.img,
                  title: res.name,
                  single:res.single,
                  pri:  res.pri,
                  num:  $('.num').val(),
                  userTel:sessionStorage.getItem('tel'),
                  userAddress:sessionStorage.getItem('userAddress'),
                  userName: sessionStorage.getItem('username')
                },
                success:function () {
                  layer.msg('加购成功,请前往购物车查看详情!')
                },error:function (msg) {
                  console.log(msg);
                }
              });
            }else{
              layer.msg("亲! 请先进行登录,再购买!")
            }


          });

          //立即购买
          $(document).on('click','.buyNow-btn',function () {
            if (sessionStorage.getItem('login_success') == 0) {
              $.ajax({
                type:"get",
                url: "/main/shopcart",
                // dataType:"json",
                data:{
                  img : res.img,
                  title: res.name,
                  single:res.single,
                  pri:  res.pri,
                  num:  $('.num').val(),
                  userName: sessionStorage.getItem('username')
                },
                success:function (res) {
                  layer.msg(res.msg,{icon:1,time:1500},function () {
                    location.replace('/page/web/shopcart.html')
                  })
                },error:function (msg) {
                  console.log(msg);
                }
              });
            }else{
              layer.msg("亲! 请先进行登录,再购买!")
            }


          })


        },error:function () {

        }
      });
    }


      var cur = $('.number-cont input').val();
      $('.number-cont .btn').on('click',function(){
        if($(this).hasClass('add')){
          cur++;
         
        }else{
          if(cur > 1){
            cur--;
          }  
        }
        $('.number-cont input').val(cur)
      })
      
  });
</script>


</body>
</html>